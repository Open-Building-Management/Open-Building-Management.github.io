<!DOCTYPE html>
<html lang="en">
<head>
    <title>OBM - Open Building Management</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="lib/bootstrap-4.5.3-dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="lib/bootstrap-4.5.3-dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
<div class="container-fluid">
    <div class="row" id="info">
        <img src=img/logo.svg>
        <table class="table">
        <tr><td>
            <dd>Chez OBM, nous nous occupons de vos systèmes énergétiques, chaudières, centrales de traitement d'air.</dd>
            <dd>Nous en supervisons le fonctionnement et faisons le lien avec votre exploitant pour la maintenance préventive.</dd>
            <dd>
                Nos algorithmes d'intelligence artificielle optimisent la distribution dans vos bâtiments, 
                pour vous permettre d'économiser de l'énergie sans aucune dégradation du confort.
            </dd>
        </td></tr>
        </table>
    </div>
    <div class="row" id="cta"></div>
</div>

<script type="module">

import * as THREE from './lib/three.module.js';
//import { GUI } from './jsm/libs/dat.gui.module.js';
import { OrbitControls } from './lib/controls/OrbitControls.js';
import { ColladaLoader } from './lib/loaders/ColladaLoader.js';

let container, info;
let camera, scene, renderer, hvac;

init();
//render();
animate();

function init() {

    container = document.getElementById( 'cta' );
    info = document.getElementById( 'info' );
    camera = new THREE.PerspectiveCamera( 65, window.innerWidth / window.innerHeight, 0.1, 2000 );
    camera.position.set( 3, 0, -6 );
    //camera.position.set( -3, 0, -6 );
    camera.lookAt( 0, 0, 0 );

    scene = new THREE.Scene();
    scene.background = new THREE.Color( 0xcbdbf4 );
    //const helper = new THREE.CameraHelper( camera );
    //scene.add( helper );

    // loading the collada file produced with sketchup
    const loadingManager = new THREE.LoadingManager( function () {
        scene.add( hvac );
    } );
    const loader = new ColladaLoader( loadingManager );
    //loader.load( './models/collada/chaufferie.dae', function ( collada ) {
    loader.load( './collada/HVAC.dae', function ( collada ) {
        hvac = collada.scene;
    } );

    //087656
    const ambientLight = new THREE.AmbientLight( 0xffffff, 0.4 );
    scene.add( ambientLight );
    const directionalLight = new THREE.DirectionalLight( 0xffffff, 0.8 );
    directionalLight.position.set( 1, 1, 0 ).normalize();
    scene.add( directionalLight );

    //
    var minus = $(info).height();
    renderer = new THREE.WebGLRenderer( { antialias: true } );
    renderer.setPixelRatio( window.devicePixelRatio );
    renderer.setSize( window.innerWidth, window.innerHeight - minus);
    renderer.localClippingEnabled = true;
    //document.body.appendChild( renderer.domElement );

    const controls = new OrbitControls( camera, renderer.domElement );
    controls.addEventListener( 'change', render ); // use only if there is no animation loop
    controls.minDistance = 1;
    controls.maxDistance = 10;
    controls.enablePan = false;

    container.appendChild( renderer.domElement );

    window.addEventListener( 'resize', onWindowResize );

}

function onWindowResize() {
    info = document.getElementById( 'info' );
    var minus = $(info).height();

    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();

    renderer.setSize( window.innerWidth, window.innerHeight - minus );

}

function animate() {

    requestAnimationFrame( animate );
    render();

}

function render() {
    var vector = camera.position.clone();
    console.log(vector);
    renderer.render( scene, camera );

}

</script>
</body>
</html>
